version: '2'

services:

  mycluster-slave-1:
    image: mathieu-rossignol/spark-hadoop-yarn-cluster
    build: .
    tty: true
    hostname: mycluster-slave-1
    container_name: mycluster-slave-1
    mem_limit: 2048m
    volumes:
      - ${PWD}/workspace:/app/workspace
    entrypoint: ["sh", "/app/workspace/files/entrypoint/slave.sh"]
    networks:
      mycluster:
        ipv4_address: 10.7.0.3

  mycluster-slave-2:
    image: mathieu-rossignol/spark-hadoop-yarn-cluster
    build: .
    tty: true
    hostname: mycluster-slave-2
    container_name: mycluster-slave-2
    mem_limit: 2048m
    volumes:
      - ${PWD}/workspace:/app/workspace
    entrypoint: ["sh", "/app/workspace/files/entrypoint/slave.sh"]
    networks:
      mycluster:
        ipv4_address: 10.7.0.4

  mycluster-master:
    image: mathieu-rossignol/spark-hadoop-yarn-cluster
    build: .
    tty: true
    hostname: mycluster-master
    container_name: mycluster-master
    mem_limit: 1024m
    volumes:
      - ${PWD}/workspace:/app/workspace
    entrypoint: ["sh", "/app/workspace/files/entrypoint/master.sh"]
    depends_on:
      - mycluster-slave-1
      - mycluster-slave-2
    ports:
      - "8088:8088"
      - "50070:50070"
      - "50090:50090"
      - "8080:8080"
      - "8030:8030"
      - "8031:8031"
      - "8032:8032"
      - "8033:8033"
      - "9000:9000"
      - "18080:18080"
    networks:
      mycluster:
        ipv4_address: 10.7.0.2

  zookeeper:
    image: wurstmeister/zookeeper:3.4.6
    tty: true
    hostname: zookeeper
    container_name: zookeeper
    mem_limit: 512m
    ports:
      - "2181:2181"
    networks:
      mycluster:
        ipv4_address: 10.7.0.5

  solr1:
    image: solr:8.2.0
    command: >
      /bin/bash -c "/opt/solr/bin/solr -c -z zookeeper:2181 -m 1g; tail -f /var/solr/logs/solr.log"
    tty: true
    hostname: solr1
    container_name: solr1
    mem_limit: 1024m
    ports:
      - "8981:8983"
    networks:
      mycluster:
        ipv4_address: 10.7.0.6
    depends_on:
      - zookeeper

  solr2:
    image: solr:8.2.0
    command: >
      /bin/bash -c "/opt/solr/bin/solr -c -f -z zookeeper:2181 -m 1g; tail -f /var/solr/logs/solr.log"
    tty: true
    hostname: solr2
    container_name: solr2
    mem_limit: 1024m
    ports:
      - "8982:8983"
    networks:
      mycluster:
        ipv4_address: 10.7.0.7
    depends_on:
      - zookeeper
      - solr1

networks:
  mycluster:
    driver: bridge
    ipam:
      config:
        - subnet: 10.7.0.0/16
          gateway: 10.7.0.1